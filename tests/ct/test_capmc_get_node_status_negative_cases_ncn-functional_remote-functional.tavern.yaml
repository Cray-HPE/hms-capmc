# Copyright 2019-2020 Hewlett Packard Enterprise Development LP

# Negative Tavern test cases for the Cray Advanced Platform Monitoring and Control (CAPMC) get_node_status API.
# Author: Mitch Schooler
# Service: Cray Advanced Platform Monitoring and Control

# HMS test metrics test cases: 13
# 1. POST /get_node_status invalid filter API response code
# 2. POST /get_node_status invalid filter API response body
# 3. POST /get_node_status garbage filter API response code
# 4. POST /get_node_status garbage filter API response body
# 5. GET /get_node_status API response code
# 6. GET /get_node_status API response body
# 7. HEAD /get_node_status API response code
# 8. PUT /get_node_status API response code
# 9. PUT /get_node_status API response body
# 10. DELETE /get_node_status API response code
# 11. DELETE /get_node_status API response body
# 12. Disabled (CASMPET-1067) - OPTIONS /get_node_status API response code
# 13. Disabled (CASMPET-1067) - OPTIONS /get_node_status API response body
# 14. PATCH /get_node_status API response code
# 15. PATCH /get_node_status API response body
---
test_name: Verify get_node_status POST method with invalid filter fails

stages:
  # 1. POST /get_node_status invalid filter API response code
  # 2. POST /get_node_status invalid filter API response body
  - name: Attempt to use get_node_status POST method with an invalid filter
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      json: {"filter": "show_fake"}
      method: POST
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 400
      body:
        e: 400
        err_msg: "invalid filter string: show_fake"

---
test_name: Verify get_node_status POST method with garbage filter fails

stages:
  # 3. POST /get_node_status garbage filter API response code
  # 4. POST /get_node_status garbage filter API response body
  - name: Attempt to use get_node_status POST method with a garbage filter
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      json: {"filter": "~!@#$%^&*"}
      method: POST
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 400
      body:
        e: 400
        err_msg: "invalid filter string: ~!@#$%^&*"

---
test_name: Verify invalid get_node_status GET method fails

stages:
  # 5. GET /get_node_status API response code
  # 6. GET /get_node_status API response body
  - name: Attempt to make an API call with an unsupported GET method
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 405
      body:
        e: 405
        err_msg: "(GET) Not Allowed"

---
test_name: Verify invalid get_node_status HEAD method fails

stages:
  # 7. HEAD /get_node_status API response code
  - name: Attempt to make an API call with an unsupported HEAD method
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      method: HEAD
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 405

---
test_name: Verify invalid get_node_status PUT method fails

stages:
  # 8. PUT /get_node_status API response code
  # 9. PUT /get_node_status API response body
  - name: Attempt to make an API call with an unsupported PUT method
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      method: PUT
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 405
      body:
        e: 405
        err_msg: "(PUT) Not Allowed"

---
test_name: Verify invalid get_node_status DELETE method fails

stages:
  # 10. DELETE /get_node_status API response code
  # 11. DELETE /get_node_status API response body
  - name: Attempt to make an API call with an unsupported DELETE method
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      method: DELETE
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 405
      body:
        e: 405
        err_msg: "(DELETE) Not Allowed"

#---
#test_name: Verify invalid get_node_status OPTIONS method fails
#
#stages:
#  # 12. Disabled (CASMPET-1067) - OPTIONS /get_node_status API response code
#  # 13. Disabled (CASMPET-1067) - OPTIONS /get_node_status API response body
#  - name: Attempt to make an API call with an unsupported OPTIONS method
#    request:
#      url: "{base_url}/capmc/capmc/v1/get_node_status"
#      method: OPTIONS
#      headers:
#        Authorization: "Bearer {access_token}"
#      verify: !bool "{verify}"
#    response:
#      status_code: 405
#      body:
#        e: 405
#        err_msg: "(OPTIONS) Not Allowed"
#
---
test_name: Verify invalid get_node_status PATCH method fails

stages:
  # 14. PATCH /get_node_status API response code
  # 15. PATCH /get_node_status API response body
  - name: Attempt to make an API call with an unsupported PATCH method
    request:
      url: "{base_url}/capmc/capmc/v1/get_node_status"
      method: PATCH
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 405
      body:
        e: 405
        err_msg: "(PATCH) Not Allowed"
